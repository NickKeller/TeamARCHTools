<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstraphacks.css">
    <link rel="stylesheet" href="css/bootstrap-slider.min.css">
    <link rel="stylesheet" href="css/archtools.css">

    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/jspdf.debug.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-slider.min.js"></script>
    <script src="js/loader.js"></script>
    <script src="js/justgage.js"></script>
    <script src="js/raphael-2.1.4.min.js"></script>
</head>
<body>

<div class="container">
    <div class="row">
        <h2 id="title" class="text-center"></h2><hr>
    </div>
    <div class="row">
        <div id="accordion" class="panel-group col-lg-6">
            <h2 class="text-center">Questions</h2>
            <div id ="question1" class="panel panel-default question">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse1">
                    <h4 class="panel-title">
                    <a>Age</a>
                    </h4>
                </div>
                <div id="collapse1" class="panel-collapse collapse in" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question1Text"></div>
                        <br/>
                        <div class="answersSection">
                            <input class="answer1 slider" type="text" data-slider-min="17" data-slider-max="49" data-slider-step="1" data-slider-value="17" data-slider-tooltip="hide"/>
                            <span> Age: <span id="answer1slider">17 or younger</span></span>
                        </div>
                    </div>
                </div>
            </div>
            <h3 id ="last6" class="collapse">In the last six months...</h3>
            <div id ="question2" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse2">
                    <h4 class="panel-title">
                    <a>Number of Sexual Partners</a>
                    </h4>
                </div>
                <div id="collapse2" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question2Text"></div>
                        <br/>
                        <div class="answersSection">
                            <input class="answer2 slider" type="text" data-slider-min="0" data-slider-max="11" data-slider-step="1" data-slider-value="0" data-slider-tooltip="hide"/>
                            <span><span id="answer2slider">0</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question3" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse3">
                    <h4 class="panel-title">
                    <a>Unprotected Receptive Sex</a>
                    </h4>
                </div>
                <div id="collapse3" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question3Text"></div>
                        <br/>
                        <!-- Radio Button answers -->
                        <div class="answer3 btn-group" data-toggle="buttons">
                            <label id="answer31" class="btn btn-primary">
                                <input type="radio" value="0"> 0 times
                            </label>
                            <label id="answer32" class="btn btn-primary">
                                <input type="radio" value="10"> 1 or more times
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question4" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse4">
                    <h4 class="panel-title">
                    <a>HIV Positive Partners</a>
                    </h4>
                </div>
                <div id="collapse4" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question4Text"></div>
                        <br/>
                        <!-- Radio Button answers -->
                        <div class="answer4 btn-group" data-toggle="buttons">
                            <label id="answer41" class="btn btn-primary">
                                <input type="radio" value="0"> 0 partners
                            </label>
                            <label id="answer42" class="btn btn-primary">
                                <input type="radio" value="1"> 1 partner
                            </label>
                            <label id="answer43" class="btn btn-primary">
                                <input type="radio" value="2"> More than 1 partner
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question5" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse5">
                    <h4 class="panel-title">
                    <a>Unprotected Insertive Sex</a>
                    </h4>
                </div>
                <div id="collapse5" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question5Text"></div>
                        <br/>
                        <!-- Radio Button answers -->
                        <div class="answer5 btn-group" data-toggle="buttons">
                            <label id="answer51" class="btn btn-primary">
                                <input type="radio" value="0"> Less than 5 times
                            </label>
                            <label id="answer52" class="btn btn-primary">
                                <input type="radio" value="1"> 5 or more times
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question6" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse6">
                    <h4 class="panel-title">
                    <a>Methamphetamine Use</a>
                    </h4>
                </div>
                <div id="collapse6" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question6Text"></div>
                        <br/>
                        <!-- Radio Button answers -->
                        <div class="answer6 btn-group" data-toggle="buttons">
                            <label id="answer61" class="btn btn-primary">
                                <input type="radio" value="0"> Yes
                            </label>
                            <label id="answer62" class="btn btn-primary">
                                <input type="radio" value="1"> No
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <h2 class="text-center">Results and Recommendations</h2>
            <div class="well">
                <div id="gauge" class="gauge" style="width:350px; height:280px"></div>
            </div>
            <h3 class="text-center">Recommended Actions</h3>
            <div class="well">
                <div id="recommended-actions-display">
                    <ul>
                        <li id="recommended-actions"></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
	<br/>
	<!--<div id ="finish" class="text-center">-->
		<!--<button type="button" id="pdf-button" data-loading-text="Loading..." class="btn btn-primary btn-lg speedometer download-pdf" autocomplete="off">-->
			<!--Save to PDF-->
		<!--</button>-->
	<!--</div>-->
    <nav id="navbar" class="navbar navbar-inverse navbar-fixed-bottom" >
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html"> ARCH Tools</a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="msm.html">MSM</a></li>
                    <li ><a href="idu.html">IDU</a></li>
                    <li ><a href="dsc.html">DSC</a></li>

                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a class="download-pdf" href="#"><span class="glyphicon glyphicon-save-file"></span> Save to PDF</a></li>

                </ul>

            </div>
        </div>
    </nav>
</div>
</body>

<script type="text/javascript">
    $(document).ready(function(){
        msmSetup();
    });

    var score = [0,0,0,0,0,0];
    var resultsToTake;
    var msmData;


    var g = new JustGage({
        id: "gauge",
        value: 0,
        min: 0,
        max: 45,
        title: "HIV Risk Index",
        shadowSize: 5,
        shadowOpacity: 0.75,
        levelColorsGradient: true
    });

    function msmSetup(){
    	//loads the json from the file, then sets the questions on the page
    	$.getJSON("ARCH-TOOLS.json", setMSMPage);
    	//wait for success
    }

    	// $(".answer3").on("click",function(){
    	// 	$("#finish").collapse("show");
    	// });

	function setMSMPage(json){
		//alert("Set page");
		msmData = json.tests.MSM;
        resultsToTake = json.results.MSM;
		$("#title").html(msmData.name);
		$("#finish").collapse("hide");
		//loop through the questions and set the text
		for(var index in msmData.questions){
			var question = msmData.questions[index];
			var text = question["text"];
			var num = question["number"];
			//set the question text
			$("#question" + num + "Text").html(text);
            $("#question" + num).collapse({toggle:false});
		}

        //show question 1
        $("#question1").collapse("show");
        //hide the results
        $("#recommended-actions-display").hide();

        //can't do this in a loop, because javascript will assume
        //the current value of num, which at the end will be 7
		$(".answer1").on("change",function(){
            //get the value of what was clicked
            var value = $(this).attr("value");
            if(value < 18){
                score[0] = 0;
            }
            else if(value >= 18 && value <= 28){
                score[0] = 8;
            }
            else if(value >= 29 && value <= 40){
                score[0] = 5;
            }
            else if(value >= 41 && value <= 48) {
                score[0] = 2;
            }
            else {
                score[0] = 0;
            }

            setScore(score);

			$("#last6").collapse("show");
			$("#question2").collapse("show");
		});

        $(".answer1").on("change", function() {
            var out;
            value = $(".answer1").data('slider').getValue();
            if (value == 49){
                out = '49 or older';
            }
            else if (value == 17) {
                out = '17 or younger'
            }
            else {
                out = value
            }
        	$("#answer1slider").text(out);
        });

        $(".answer2").on("change",function(){
            //get the value of what was clicked
            var value = $(this).attr("value");
            if(value <= 5){
                score[1] = 0;
            }
            else if(value >= 6 && value <= 10){
                score[1] = 4;
            }
            else {
                score[1] = 7;
            }

            setScore(score);

			// $("#last6").collapse("show");
			$("#question3").collapse("show");
		});

        $(".answer2").on("change", function() {
            var out;
            var value = $(".answer2").data('slider').getValue();
            if (value == 11){
                out = '11 or more';
            }
            else {
                out = value
            }

        	$("#answer2slider").text(out);
        });


        $("#answer31").on("click", function(){
            score[2] = 0;

            setScore(score);
            $("#question4").collapse("show");
        });

        $("#answer32").on("click", function(){
            score[2] = 10;

            setScore(score);
            $("#question4").collapse("show");
        });

        $("#answer41").on("click", function(){
            score[3] = 0;

            setScore(score);
            $("#question5").collapse("show");
        });

        $("#answer42").on("click", function(){
            score[3] = 4;

            setScore(score);
            $("#question5").collapse("show");
        });

        $("#answer43").on("click", function(){
            score[3] = 8;

            setScore(score);
            $("#question5").collapse("show");
        })

        $("#answer51").on("click", function(){
            score[4] = 0;

            setScore(score);
            $("#question6").collapse("show");
        });

        $("#answer52").on("click", function(){
            score[4] = 6;

            setScore(score);
            $("#question6").collapse("show");
        });

        $("#answer61").on("click", function(){
            score[5] = 6;

            setScore(score);
        });

        $("#answer62").on("click", function(){
            score[5] = 0;

            setScore(score);
        });

        setupSliders();
	}

    function setScore(val){
        var total = 0;

        for(var i = 0; i < val.length; i++) {
            total += val[i];
        }

        g.refresh(total);
        var actionToDisplay = resultsToTake[">10"];
        if(total <= 10){
            actionToDisplay = resultsToTake["<10"];
        }
        $("#recommended-actions-display").show();
        $("#recommended-actions").html(actionToDisplay);
    }

   $(".download-pdf").on("click",function(){
        $("#gauge").find("text")[1].style.fontSize = "125px";
        $("#navbar").addClass("collapse");
        var pdf = new jsPDF('p', 'pt', 'letter');
        pdf.addHTML($('document')[0], function () {
            pdf.save('Test.pdf');
        });
        $("#navbar").removeClass("collapse");
        $("#gauge").find("text")[1].style.fontSize = "49px";
    });

    function setupSliders() {
        $('.answer1').slider({
        	formatter: function(value) {
                if (value == 49)
                    return '49 or above'
                if (value == 17)
                    return '17 or below'
        		return value;
        	}
        });
        $('.answer2').slider({
            formatter: function(value) {
                if(value == 11) {
                    return '11 or more'
                }
                return value;
            }
        })
    }

</script>
</html>
