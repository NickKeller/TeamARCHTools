<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/bootstrap-slider.min.css">
  <link rel="stylesheet" href="css/archtools.css">

  <script src="js/jquery-3.1.1.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/bootstrap-slider.min.js"></script>
  <script src="js/loader.js"></script>
</head>
<body>

<div class="container">
    <div class="row">
        <h2 id="title"></h2>
    </div>
    <div class="row">
        <div id="accordion" class="panel-group col-lg-6">
            <div id ="question1" class="panel panel-default question">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse1">
                    <h4 class="panel-title">
                    <a>Question 1</a>
                    </h4>
                </div>
                <div id="collapse1" class="panel-collapse collapse in" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question1Text"></div>
                        <br/>
                        <div class="answersSection">
                            <input class="answer1" type="text" data-slider-min="0" data-slider-max="60" data-slider-step="1"/>
                        </div>
                    </div>
                </div>
            </div>
            <h3 id ="last6" class="collapse">In the last six months...</h3>
            <div id ="question2" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse2">
                    <h4 class="panel-title">
                    <a>Question 2</a>
                    </h4>
                </div>
                <div id="collapse2" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question2Text"></div>
                        <br/>
                        <div class="answersSection">
                            <div class="answer2 btn btn-primary" type="radio" name="methadone" value="Yes" >Yes</div>
                            <div class="answer2 btn btn-primary" type="radio" name="methadone" value="No">No</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question3" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse3">
                    <h4 class="panel-title">
                    <a>Question 3</a>
                    </h4>
                </div>
                <div id="collapse3" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question3Text"></div>
                        <br/>
                        <div class="answersSection">
                            <div class="answer3 btn btn-primary" type="radio" name="heroin" value="0" >0 times</div>
                            <div class="answer3 btn btn-primary" type="radio" name="heroin" value="1">1 or more times</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question4" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse4">
                    <h4 class="panel-title">
                    <a>Question 4</a>
                    </h4>
                </div>
                <div id="collapse4" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question4Text"></div>
                        <br/>collapse
                        <div class="answersSection">
                            <div class="answer4 btn btn-primary" type="radio" name="cocaine" value="0" >0 times</div>
                            <div class="answer4 btn btn-primary" type="radio" name="cocaine" value="1">1 or more times</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question5" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse5">
                    <h4 class="panel-title">
                    <a>Question 5</a>
                    </h4>
                </div>
                <div id="collapse5" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question5Text"></div>
                        <br/>
                        <div class="answersSection">
                            <div class="answer5 btn btn-primary" type="radio" name="cooker" value="0" >0 times</div>
                            <div class="answer5 btn btn-primary" type="radio" name="cooker" value="1">1 or more times</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question6" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse6">
                    <h4 class="panel-title">
                    <a>Question 6</a>
                    </h4>
                </div>
                <div id="collapse6" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question6Text"></div>
                        <br/>
                        <div class="answersSection">
                            <div class="answer6 btn btn-primary" type="radio" name="needles" value="0" >0 times</div>
                            <div class="answer6 btn btn-primary" type="radio" name="needles" value="1">1 or more times</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question7" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse7">
                    <h4 class="panel-title">
                    <a>Question 7</a>
                    </h4>
                </div>
                <div id="collapse7" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question7Text"></div>
                        <br/>
                        <div class="answersSection">
                            <div class="answer7 btn btn-primary" type="radio" name="gallery" value="0" >0 times</div>
                            <div class="answer7 btn btn-primary" type="radio" name="gallery" value="1">1 or more times</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <h2>Results and Recommendations</h2>
            <p>Score:</p><p id="score"></p>
            <p>Subscore:</p><p id="subscore"></p>
            <div class="gauge-area">
                <div class="gauge-a"></div>
                <div class="gauge-b"></div>
                <div class="gauge-c"></div>
                <div class="gauge-data">
                    <h1 id="gauge-score">0</h1>
                </div>
            </div>

        </div>
    </div>
	<br/>
	<div id ="finish" class="text-center">
		<button type="button" id="pdf-button" data-loading-text="Loading..." class="btn btn-primary btn-lg" autocomplete="off">
			Save to PDF
		</button>
	</div>
</div>
</body>

<script type="text/javascript">
    $(document).ready(function(){
        iduSetup();
    });

    var score = 0;
    var subscore = 0;

    function iduSetup(){
    	//loads the json from the file, then sets the questions on the page
    	$.getJSON("ARCH-TOOLS.json", setIDUPage);
    	//wait for success
    }

    	// $(".answer3").on("click",function(){
    	// 	$("#finish").collapse("show");
    	// });

	function setIDUPage(json){
		//alert("Set page");
		var iduData = json.tests.IDU;
		$("#title").html(iduData.name);
		$("#finish").collapse("hide");
		//loop through the questions and set the text
		for(var index in iduData.questions){
			var question = iduData.questions[index];
			var text = question["text"];
			var num = question["number"];
			//set the question text
			$("#question" + num + "Text").html(text);
            $("#question" + num).collapse({toggle:false});
		}

        //show question 1
        $("#question1").collapse("show");


        //can't do this in a loop, because javascript will assume
        //the current value of num, which at the end will be 7
		$(".answer1").on("change",function(){
            //get the value of what was clicked
            var value = $(this).attr("value");
            if(value < 30){
                score = 38;
            }
            else if(value > 30 && value < 40){
                score = 24;
            }
            else if(value > 40 && value < 50){
                score = 7;
            }
            else{
                score = 0;
            }
            $("#score").html(score);
            setScore(score);
			$("#last6").collapse("show");
			$("#question2").collapse("show");
		});

	    $(".answer2").on("click",function(){
            //get the value
            var value = $(this).attr("value");
            if(value === "No"){
                score += 31;
            }
            $("#score").html(score);
            setScore(score);
            $("#question3").collapse("show");
	    });

        $(".answer3").on("click",function(){
            //get the value
            var value = $(this).attr("value");
            if(value === "1"){
                subscore += 1;
            }
            $("#subscore").html(subscore);
            $("#question4").collapse("show");
        });

	    $(".answer4").on("click",function(){
            //get the value
            var value = $(this).attr("value");
            if(value === "1"){
                subscore += 1;
            }
            $("#subscore").html(subscore);

            $("#question5").collapse("show");
	    });

	    $(".answer5").on("click",function(){
            //get the value
            var value = $(this).attr("value");
            if(value === "1"){
                subscore += 1;
            }
            $("#subscore").html(subscore);

	        $("#question6").collapse("show");
	    });

	    $(".answer6").on("click",function(){
            //get the value
            var value = $(this).attr("value");
            if(value === "1"){
                subscore += 1;
            }
            $("#subscore").html(subscore);

	        $("#question7").collapse("show");
	    });

        $(".answer7").on("click", function(){
            //get the value
            var value = $(this).attr("value");
            if(value === "1"){
                subscore += 1;
            }
            $("#subscore").html(subscore);

            switch (subscore) {
                case 1:
                    score += 7;
                    break;
                case 2:
                    score += 21;
                    break;
                case 3:
                    score += 24;
                    break;
                case 4:
                    score += 24;
                    break;
                case 5:
                    score += 31;
                    break;
                case 0:
                default:
                    break;
            }
            $("#score").html(score);
            setScore(score);
        });

        setupSliders();
	}

    function setScore(val){
        $("#gauge-score").html(val);
    }

    function setupSliders() {
        $('.answer1').slider({
        	formatter: function(value) {
                if (value == 60)
                    return 'Age: 60+'
        		return 'Age: ' + value;
        	}
        });
    }

</script>
</html>
