<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-slider.min.css">
    <link rel="stylesheet" href="css/archtools.css">

    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-slider.min.js"></script>
    <script src="js/loader.js"></script>
    <script src="js/justgage.js"></script>
    <script src="js/raphael-2.1.4.min.js"></script>
</head>
<body>

<div class="container">
    <div class="row">
        <h2 id="title"></h2>
    </div>
    <div class="row">
        <div id="accordion" class="panel-group col-lg-6">
            <div id ="question1" class="panel panel-default question">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse1">
                    <h4 class="panel-title">
                    <a>Question 1</a>
                    </h4>
                </div>
                <div id="collapse1" class="panel-collapse collapse in" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question1Text"></div>
                        <br/>
                        <div class="answersSection">
                            <input class="answer1" type="text"  data-slider-tooltip="hide" data-slider-min="17" data-slider-max="50" data-slider-step="1" data-slider-value="17"/>
                            <span>Age: <span id="answer1slider">17 or younger</span></span>
                        </div>
                    </div>
                </div>
            </div>
            <h3 id ="last6" class="collapse">In the last six months...</h3>
            <div id ="question2" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse2">
                    <h4 class="panel-title">
                    <a>Question 2</a>
                    </h4>
                </div>
                <div id="collapse2" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question2Text"></div>
                        <br/>
                        <!-- Radio Button answers -->
                        <div class="answer2 btn-group" data-toggle="buttons">
                            <label id="answer21" class="btn btn-primary">
                                <input type="radio" value="Yes"> Yes
                            </label>
                            <label id="answer22" class="btn btn-primary">
                                <input type="radio" value="No"> No
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question3" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse3">
                    <h4 class="panel-title">
                    <a>Question 3</a>
                    </h4>
                </div>
                <div id="collapse3" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question3Text"></div>
                        <br/>
                        <!-- Radio Button answers -->
                        <div class="answer3 btn-group" data-toggle="buttons">
                            <label id="answer31" class="btn btn-primary">
                                <input type="radio" value="0"> 0 times
                            </label>
                            <label id="answer32" class="btn btn-primary">
                                <input type="radio" value="1"> 1 or more times
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question4" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse4">
                    <h4 class="panel-title">
                    <a>Question 4</a>
                    </h4>
                </div>
                <div id="collapse4" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question4Text"></div>
                        <br/>
                        <!-- Radio Button answers -->
                        <div class="answer4 btn-group" data-toggle="buttons">
                            <label id="answer41" class="btn btn-primary">
                                <input type="radio" value="0"> 0 times
                            </label>
                            <label id="answer42" class="btn btn-primary">
                                <input type="radio" value="1"> 1 or more times
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question5" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse5">
                    <h4 class="panel-title">
                    <a>Question 5</a>
                    </h4>
                </div>
                <div id="collapse5" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question5Text"></div>
                        <br/>
                        <!-- Radio Button answers -->
                        <div class="answer5 btn-group" data-toggle="buttons">
                            <label id="answer51" class="btn btn-primary">
                                <input type="radio" value="0"> 0 times
                            </label>
                            <label id="answer52" class="btn btn-primary">
                                <input type="radio" value="1"> 1 or more times
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question6" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse6">
                    <h4 class="panel-title">
                    <a>Question 6</a>
                    </h4>
                </div>
                <div id="collapse6" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question6Text"></div>
                        <br/>
                        <!-- Radio Button answers -->
                        <div class="answer6 btn-group" data-toggle="buttons">
                            <label id="answer61" class="btn btn-primary">
                                <input type="radio" value="0"> 0 times
                            </label>
                            <label id="answer62" class="btn btn-primary">
                                <input type="radio" value="1"> 1 or more times
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id ="question7" class="panel panel-default question collapse">
                <div class="panel-heading"  data-toggle="collapse" data-parent="#accordion" href="#collapse7">
                    <h4 class="panel-title">
                    <a>Question 7</a>
                    </h4>
                </div>
                <div id="collapse7" class="panel-collapse collapse" data-parent="#accordion">
                    <div class="panel-body">
                        <div id="question7Text"></div>
                        <br/>
                        <!-- Radio Button answers -->
                        <div class="answer7 btn-group" data-toggle="buttons">
                            <label id="answer71" class="btn btn-primary">
                                <input type="radio" value="0"> 0 times
                            </label>
                            <label id="answer72" class="btn btn-primary">
                                <input type="radio" value="1"> 1 or more times
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <h2>Results and Recommendations</h2>
            <p>Score:</p><p id="score"></p>
            <div id="gauge" style="width:400px; height:320px"></div>
        </div>
    </div>
	<br/>
	<div id ="finish" class="text-center">
		<button type="button" id="pdf-button" data-loading-text="Loading..." class="btn btn-primary btn-lg speedometer" autocomplete="off">
			Save to PDF
		</button>
	</div>
</div>
</body>

<script type="text/javascript">
    $(document).ready(function(){
        iduSetup();
    });

    var score = [0,0];
    var subscore = [0,0,0,0,0];

    var g = new JustGage({
        id: "gauge",
        value: 0,
        min: 0,
        max: 100,
        title: "HIV Risk Index",
        shadowSize: 5,
        shadowOpacity: 0.75,
        levelColorsGradient: true
    });

    function iduSetup(){
    	//loads the json from the file, then sets the questions on the page
    	$.getJSON("ARCH-TOOLS.json", setIDUPage);
    	//wait for success
    }

    	// $(".answer3").on("click",function(){
    	// 	$("#finish").collapse("show");
    	// });

	function setIDUPage(json){
		//alert("Set page");
		var iduData = json.tests.IDU;
		$("#title").html(iduData.name);
		$("#finish").collapse("hide");
		//loop through the questions and set the text
		for(var index in iduData.questions){
			var question = iduData.questions[index];
			var text = question["text"];
			var num = question["number"];
			//set the question text
			$("#question" + num + "Text").html(text);
            $("#question" + num).collapse({toggle:false});
		}

        //show question 1
        $("#question1").collapse("show");


        //can't do this in a loop, because javascript will assume
        //the current value of num, which at the end will be 7
		$(".answer1").on("change",function(){
            //get the value of what was clicked
            var value = $(this).attr("value");
            if(value < 30){
                score[0] = 38;
            }
            else if(value >= 30 && value < 40){
                score[0] = 24;
            }
            else if(value > 40 && value < 50){
                score[0] = 7;
            }
            else {
                score[0] = 0;
            }

            setScore(score);

			$("#last6").collapse("show");
			$("#question2").collapse("show");
		});

        $(".answer1").on("slide", function(slideEvt) {
            var out;
            if (slideEvt.value == 50){
                out = '50 or older';
            }
            else if (slideEvt.value == 17) {
                out = '17 or younger'
            }
            else {
                out = slideEvt.value
            }
        	$("#answer1slider").text(out);
        });

        $("#answer21").on("click", function(){
            score[1] = 0;

            setScore(score);
            $("#question3").collapse("show");
        });

        $("#answer22").on("click", function(){
            score[1] = 31;

            setScore(score);
            $("#question3").collapse("show");
        });

        $("#answer31").on("click", function(){
            subscore[0] = 0;

            setScore(score);
            $("#question4").collapse("show");
        });

        $("#answer32").on("click", function(){
            subscore[0] = 1;

            setScore(score);
            $("#question4").collapse("show");
        });

        $("#answer41").on("click", function(){
            subscore[1] = 0;

            setScore(score);
            $("#question5").collapse("show");
        });

        $("#answer42").on("click", function(){
            subscore[1] = 1;

            setScore(score);
            $("#question5").collapse("show");
        });

        $("#answer51").on("click", function(){
            subscore[2] = 0;

            setScore(score);
            $("#question6").collapse("show");
        });

        $("#answer52").on("click", function(){
            subscore[2] = 1;

            setScore(score);
            $("#question6").collapse("show");
        });

        $("#answer61").on("click", function(){
            subscore[3] = 0;

            setScore(score);
            $("#question7").collapse("show");
        });

        $("#answer62").on("click", function(){
            subscore[3] = 1;

            setScore(score);
            $("#question7").collapse("show");
        });

        $("#answer71").on("click", function(){
            subscore[4] = 0;

            setScore(score);
        });

        $("#answer72").on("click", function(){
            subscore[4] = 1;

            setScore(score);
        });

        setupSliders();
	}

    function setScore(val){
        var total = score[0] + score[1];
        var sub_total = 0;
        for (var i = 0, len = subscore.length; i < len; i++) {
            sub_total += subscore[i];
        }

        switch (sub_total) {
            case 1:
                total += 7;
                break;
            case 2:
                total += 21;
                break;
            case 3:
                total += 24;
                break;
            case 4:
                total += 24;
                break;
            case 5:
                total += 31;
                break;
            case 0:
            default:
                break;
        }

        g.refresh(total);
    }

    function setupSliders() {
        $('.answer1').slider({
        	formatter: function(value) {
                if (value == 60)
                    return 'Age: 60+'
        		return 'Age: ' + value;
        	}
        });
    }

</script>
</html>
